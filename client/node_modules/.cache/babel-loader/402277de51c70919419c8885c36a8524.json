{"ast":null,"code":"import _regeneratorRuntime from\"/Users/TGAP/Desktop/crown-clothing/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"/Users/TGAP/Desktop/crown-clothing/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";var _marked=/*#__PURE__*/_regeneratorRuntime.mark(getSnapshotFromUserAuth),_marked2=/*#__PURE__*/_regeneratorRuntime.mark(signInWithGoogle),_marked3=/*#__PURE__*/_regeneratorRuntime.mark(onGoogleSignInStart),_marked4=/*#__PURE__*/_regeneratorRuntime.mark(signInWithEmail),_marked5=/*#__PURE__*/_regeneratorRuntime.mark(onEmailSignInStart),_marked6=/*#__PURE__*/_regeneratorRuntime.mark(signUp),_marked7=/*#__PURE__*/_regeneratorRuntime.mark(onSignUpStart),_marked8=/*#__PURE__*/_regeneratorRuntime.mark(isUserAuthenticated),_marked9=/*#__PURE__*/_regeneratorRuntime.mark(onCheckUserSession),_marked10=/*#__PURE__*/_regeneratorRuntime.mark(signOut),_marked11=/*#__PURE__*/_regeneratorRuntime.mark(onSignOutStart),_marked12=/*#__PURE__*/_regeneratorRuntime.mark(userSagas);import{takeLatest,put,all,call}from'redux-saga/effects';import{auth,googleProvider,createUserProfileDocument,getCurrentUser,saveUserCart}from'../../firebase/firebase-utils';import Types from'./user-types';import{signInSuccess,signInFailure,signOutSuccess,signOutFailure}from'./user-actions';import{addPreviousUserCart}from'../cart/cart-actions';function getSnapshotFromUserAuth(userAuth){var _len,rest,_key,userRef,userSnapshot,_args=arguments;return _regeneratorRuntime.wrap(function getSnapshotFromUserAuth$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;for(_len=_args.length,rest=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){rest[_key-1]=_args[_key];}_context.next=4;return call.apply(void 0,[createUserProfileDocument,userAuth].concat(rest));case 4:userRef=_context.sent;_context.next=7;return call([userRef,userRef.get]);case 7:userSnapshot=_context.sent;_context.next=10;return put(signInSuccess(_objectSpread({id:userSnapshot.id},userSnapshot.data())));case 10:_context.next=12;return put(addPreviousUserCart(userSnapshot.data().cart));case 12:_context.next=18;break;case 14:_context.prev=14;_context.t0=_context[\"catch\"](0);_context.next=18;return put(signInFailure(_context.t0));case 18:case\"end\":return _context.stop();}}},_marked,null,[[0,14]]);};function signInWithGoogle(){var _yield$call,user;return _regeneratorRuntime.wrap(function signInWithGoogle$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return call([auth,auth.signInWithPopup],googleProvider);case 3:_yield$call=_context2.sent;user=_yield$call.user;_context2.next=7;return call(getSnapshotFromUserAuth,user);case 7:_context2.next=13;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](0);_context2.next=13;return put(signInFailure(_context2.t0));case 13:case\"end\":return _context2.stop();}}},_marked2,null,[[0,9]]);};function onGoogleSignInStart(){return _regeneratorRuntime.wrap(function onGoogleSignInStart$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return takeLatest(Types.GOOGLE_SIGN_IN_START,signInWithGoogle);case 2:case\"end\":return _context3.stop();}}},_marked3);};function signInWithEmail(_ref){var _ref$payload,email,password,_yield$call2,user;return _regeneratorRuntime.wrap(function signInWithEmail$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_ref$payload=_ref.payload,email=_ref$payload.email,password=_ref$payload.password;_context4.prev=1;_context4.next=4;return call([auth,auth.signInWithEmailAndPassword],email,password);case 4:_yield$call2=_context4.sent;user=_yield$call2.user;_context4.next=8;return call(getSnapshotFromUserAuth,user);case 8:_context4.next=14;break;case 10:_context4.prev=10;_context4.t0=_context4[\"catch\"](1);_context4.next=14;return put(signInFailure(_context4.t0));case 14:case\"end\":return _context4.stop();}}},_marked4,null,[[1,10]]);};function onEmailSignInStart(){return _regeneratorRuntime.wrap(function onEmailSignInStart$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return takeLatest(Types.EMAIL_SIGN_IN_START,signInWithEmail);case 2:case\"end\":return _context5.stop();}}},_marked5);};function signUp(_ref2){var payload,_ref2$payload,email,password,displayName,_yield$call3,user;return _regeneratorRuntime.wrap(function signUp$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:payload=_ref2.payload,_ref2$payload=_ref2.payload,email=_ref2$payload.email,password=_ref2$payload.password,displayName=_ref2$payload.displayName;console.log(payload);_context6.prev=2;_context6.next=5;return call([auth,auth.createUserWithEmailAndPassword],email,password);case 5:_yield$call3=_context6.sent;user=_yield$call3.user;_context6.next=9;return call(getSnapshotFromUserAuth,user,{displayName:displayName});case 9:_context6.next=15;break;case 11:_context6.prev=11;_context6.t0=_context6[\"catch\"](2);_context6.next=15;return put(signInFailure(_context6.t0));case 15:case\"end\":return _context6.stop();}}},_marked6,null,[[2,11]]);};function onSignUpStart(){return _regeneratorRuntime.wrap(function onSignUpStart$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:_context7.next=2;return takeLatest(Types.SIGN_UP_START,signUp);case 2:case\"end\":return _context7.stop();}}},_marked7);};function isUserAuthenticated(){var userAuth;return _regeneratorRuntime.wrap(function isUserAuthenticated$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:_context8.prev=0;_context8.next=3;return call(getCurrentUser);case 3:userAuth=_context8.sent;if(userAuth){_context8.next=6;break;}return _context8.abrupt(\"return\");case 6:_context8.next=8;return call(getSnapshotFromUserAuth,userAuth);case 8:_context8.next=14;break;case 10:_context8.prev=10;_context8.t0=_context8[\"catch\"](0);_context8.next=14;return put(signInFailure(_context8.t0));case 14:case\"end\":return _context8.stop();}}},_marked8,null,[[0,10]]);}function onCheckUserSession(){return _regeneratorRuntime.wrap(function onCheckUserSession$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:_context9.next=2;return takeLatest(Types.CHECK_USER_SESSION,isUserAuthenticated);case 2:case\"end\":return _context9.stop();}}},_marked9);}function signOut(_ref3){var _ref3$payload,currentUser,cartItems;return _regeneratorRuntime.wrap(function signOut$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:_ref3$payload=_ref3.payload,currentUser=_ref3$payload.currentUser,cartItems=_ref3$payload.cartItems;_context10.prev=1;_context10.next=4;return call(saveUserCart,currentUser,cartItems);case 4:_context10.next=6;return call([auth,auth.signOut]);case 6:_context10.next=8;return put(signOutSuccess());case 8:_context10.next=14;break;case 10:_context10.prev=10;_context10.t0=_context10[\"catch\"](1);_context10.next=14;return put(signOutFailure(_context10.t0));case 14:case\"end\":return _context10.stop();}}},_marked10,null,[[1,10]]);}function onSignOutStart(){return _regeneratorRuntime.wrap(function onSignOutStart$(_context11){while(1){switch(_context11.prev=_context11.next){case 0:_context11.next=2;return takeLatest(Types.SIGN_OUT_START,signOut);case 2:case\"end\":return _context11.stop();}}},_marked11);};export default function userSagas(){return _regeneratorRuntime.wrap(function userSagas$(_context12){while(1){switch(_context12.prev=_context12.next){case 0:_context12.next=2;return all([call(onGoogleSignInStart),call(onEmailSignInStart),call(onCheckUserSession),call(onSignOutStart),call(onSignUpStart)]);case 2:case\"end\":return _context12.stop();}}},_marked12);};","map":{"version":3,"sources":["/Users/TGAP/Desktop/crown-clothing/client/src/redux/user/user-sagas.js"],"names":["getSnapshotFromUserAuth","signInWithGoogle","onGoogleSignInStart","signInWithEmail","onEmailSignInStart","signUp","onSignUpStart","isUserAuthenticated","onCheckUserSession","signOut","onSignOutStart","userSagas","takeLatest","put","all","call","auth","googleProvider","createUserProfileDocument","getCurrentUser","saveUserCart","Types","signInSuccess","signInFailure","signOutSuccess","signOutFailure","addPreviousUserCart","userAuth","rest","userRef","get","userSnapshot","id","data","cart","signInWithPopup","user","GOOGLE_SIGN_IN_START","payload","email","password","signInWithEmailAndPassword","EMAIL_SIGN_IN_START","displayName","console","log","createUserWithEmailAndPassword","SIGN_UP_START","CHECK_USER_SESSION","currentUser","cartItems","SIGN_OUT_START"],"mappings":"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","sourcesContent":["import {takeLatest, put, all, call} from 'redux-saga/effects';\nimport {auth, googleProvider, createUserProfileDocument, getCurrentUser, saveUserCart} from '../../firebase/firebase-utils';\nimport Types from './user-types';\nimport {signInSuccess, signInFailure, signOutSuccess, signOutFailure} from './user-actions';\nimport {addPreviousUserCart} from '../cart/cart-actions';\n\n\nfunction* getSnapshotFromUserAuth(userAuth, ...rest) {\n  try {\n    const userRef = yield call(createUserProfileDocument, userAuth, ...rest);\n    const userSnapshot = yield call([userRef, userRef.get]);\n    yield put(signInSuccess(\n      {id: userSnapshot.id, ...userSnapshot.data()}\n    ));\n    yield put(addPreviousUserCart(userSnapshot.data().cart));\n  } catch(error) {\n    yield put(signInFailure(error));\n  }\n};\n\n\nfunction* signInWithGoogle() {\n  try {\n    const {user} = yield call([auth, auth.signInWithPopup], googleProvider);\n    yield call(getSnapshotFromUserAuth, user);\n  } catch(error) {\n    yield put(signInFailure(error)); \n  }\n};\n\nfunction* onGoogleSignInStart() {\n  yield takeLatest(Types.GOOGLE_SIGN_IN_START, signInWithGoogle);\n};\n\n\nfunction* signInWithEmail({payload: {email, password}}) {\n  try {\n    const {user} = yield call(\n      [auth, auth.signInWithEmailAndPassword], email, password\n    );\n    yield call(getSnapshotFromUserAuth, user);\n  } catch(error) {\n    yield put(signInFailure(error)); \n  }\n};\n\nfunction* onEmailSignInStart() {\n  yield takeLatest(Types.EMAIL_SIGN_IN_START, signInWithEmail);\n};\n\n\nfunction* signUp({payload, payload: {email, password, displayName}}) {\n  console.log(payload)\n  try {\n    const {user} = yield call(\n      [auth, auth.createUserWithEmailAndPassword], email, password\n    );\n    yield call(getSnapshotFromUserAuth, user, {displayName});\n  } catch(error) {\n    yield put(signInFailure(error))\n  }\n};\n\nfunction* onSignUpStart() {\n  yield takeLatest(Types.SIGN_UP_START, signUp);\n};\n\n\nfunction* isUserAuthenticated() {\n  try {\n    const userAuth = yield call(getCurrentUser);\n    if (!userAuth) return;\n    yield call (getSnapshotFromUserAuth, userAuth);\n  } catch(error) {\n    yield put(signInFailure(error));\n  }\n}\n\nfunction* onCheckUserSession() {\n  yield takeLatest(Types.CHECK_USER_SESSION, isUserAuthenticated);\n}\n\n\nfunction* signOut({payload: {currentUser, cartItems}}) {\n  try {\n    yield call(saveUserCart, currentUser, cartItems);\n    yield call([auth, auth.signOut]);\n    yield put(signOutSuccess());\n  } catch(error) {\n    yield put(signOutFailure(error))\n  }\n}\n\nfunction* onSignOutStart() {\n  yield takeLatest(Types.SIGN_OUT_START, signOut);\n};\n\n\nexport default function* userSagas() {\n  yield all([\n    call(onGoogleSignInStart),\n    call(onEmailSignInStart),\n    call(onCheckUserSession),\n    call(onSignOutStart),\n    call(onSignUpStart)\n  ]);\n};"]},"metadata":{},"sourceType":"module"}